@page
@model PrivacyModel
@{
    ViewData["Title"] = "Privacy Policy";
}

<h1>@ViewData["Title"]</h1>

<p>Use this page to detail your site's privacy policy.</p>


<!-- Privacy Chatbot Full Page -->
<div id="privacy-chatbot-full" style="max-width:600px; margin:40px auto; background:#f8f9fa; border-radius:18px; box-shadow:0 4px 24px rgba(0,0,0,0.18);">
    <div style="padding:16px 18px; border-bottom:1px solid #e3e3e3; background:#1b6ec2; color:#fff; border-top-left-radius:18px; border-top-right-radius:18px; display:flex; align-items:center;">
        <img src="https://ui-avatars.com/api/?name=Bot&background=1b6ec2&color=fff&size=32" style="width:32px; height:32px; border-radius:50%; margin-right:10px;" alt="Bot Avatar">
        <span style="font-weight:bold; font-size:1.1rem;">Privacy Assistant</span>
    </div>
    <div id="privacy-chatbot-messages" style="height:350px; overflow-y:auto; padding:18px; background:#fff; border-bottom:1px solid #e3e3e3;"></div>
    <div style="padding:14px 18px; background:#f8f9fa; border-bottom-left-radius:18px; border-bottom-right-radius:18px;">
        <div style="display:flex; gap:8px;">
            <input type="text" id="privacy-chatbot-input" style="flex:1; border-radius:12px; border:1.5px solid #d2d2d7; padding:10px 16px; font-size:1.08rem; background:#fff; color:#1d1d1f;" placeholder="Type your privacy question..." />
            <button id="privacy-chatbot-send" type="button" class="btn btn-success" style="border-radius:12px; font-size:1.08rem; font-weight:500; min-width:110px;">Send</button>
        </div>
        <div style="margin-top:12px;">
            <div style="font-size:0.98rem; color:#555; margin-bottom:6px;">Sample questions you can ask:</div>
            <ul id="privacy-sample-questions" style="padding-left:18px; margin-bottom:0; color:#444; font-size:0.97rem; list-style-type:disc;">
                <li class="privacy-sample-question" style="cursor:pointer; transition:background 0.2s, color 0.2s;">How does this site use my personal data?</li>
                <li class="privacy-sample-question" style="cursor:pointer; transition:background 0.2s, color 0.2s;">Can I request deletion of my information?</li>
                <li class="privacy-sample-question" style="cursor:pointer; transition:background 0.2s, color 0.2s;">Is my payment information stored securely?</li>
                <li class="privacy-sample-question" style="cursor:pointer; transition:background 0.2s, color 0.2s;">Who can access my data?</li>
                <li class="privacy-sample-question" style="cursor:pointer; transition:background 0.2s, color 0.2s;">How do I update my privacy preferences?</li>
            </ul>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        .privacy-sample-question:hover {
            background: #e3e3e3;
            color: #1b6ec2;
            border-radius: 8px;
        }
    </style>
    <script>
        // Full page chatbot, no open/close logic needed
        const privacySendBtn = document.getElementById('privacy-chatbot-send');
        const privacyInput = document.getElementById('privacy-chatbot-input');
        const privacyMessages = document.getElementById('privacy-chatbot-messages');

        privacySendBtn.onclick = sendPrivacyMessage;
        privacyInput.addEventListener('keydown', function(e) { if (e.key === 'Enter') sendPrivacyMessage(); });

        // Sample questions click-to-populate
        document.querySelectorAll('.privacy-sample-question').forEach(function(item) {
            item.addEventListener('click', function() {
                privacyInput.value = item.textContent;
                privacyInput.focus();
            });
        });

        function appendPrivacyMessage(role, text) {
            const div = document.createElement('div');
            div.style.display = 'flex';
            div.style.marginBottom = '12px';
            if (role === 'You') {
                div.innerHTML = `
                    <div style='margin-left:auto; display:flex; align-items:center;'>
                        <span style='background:#e3e3e3; color:#333; padding:8px 14px; border-radius:16px 16px 2px 16px; font-size:1rem; max-width:220px; word-break:break-word;'>${text}</span>
                        <img src='https://ui-avatars.com/api/?name=You&background=6c757d&color=fff&size=28' style='width:28px; height:28px; border-radius:50%; margin-left:8px;' alt='User Avatar'>
                    </div>
                `;
            } else {
                div.innerHTML = `
                    <div style='display:flex; align-items:center;'>
                        <img src='https://ui-avatars.com/api/?name=Bot&background=1b6ec2&color=fff&size=28' style='width:28px; height:28px; border-radius:50%; margin-right:8px;' alt='Bot Avatar'>
                        <span style='background:#1b6ec2; color:#fff; padding:8px 14px; border-radius:16px 16px 16px 2px; font-size:1rem; max-width:220px; word-break:break-word;'>${text}</span>
                    </div>
                `;
            }
            privacyMessages.appendChild(div);
            privacyMessages.scrollTop = privacyMessages.scrollHeight;
        }

        function sendPrivacyMessage() {
            const userText = privacyInput.value.trim();
            if (!userText) return;
            appendPrivacyMessage('You', userText);
            privacyInput.value = '';
            fetch('/api/chatbot/privacy', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: userText })
            })
            .then(res => res.json())
            .then(data => {
                appendPrivacyMessage('Bot', data.reply);
            })
            .catch(() => {
                appendPrivacyMessage('Bot', 'Sorry, something went wrong.');
            });
        }
    </script>
}
