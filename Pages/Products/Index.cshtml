@page
@model RetailMonolith.Pages.Products.IndexModel
@{
    ViewData["Title"] = "Products";
}

<div class="hero-panel">
    <div class="hero-pill">Premium, curated, effortless</div>
    <h1>Elevate every day with thoughtful essentials.</h1>
    <p>We bring you a curated edit of reliable favorites alongside the latest innovations, delivered inside a calm, white space that keeps the product front and center.</p>
    <div class="d-flex flex-wrap align-items-center gap-3 mt-4">
        <a class="btn btn-primary" asp-page="/Products/Index">Start Shopping</a>
        <a class="btn btn-secondary" href="/Cart">View Cart</a>
        <span class="badge-accent">Fast shipping â€¢ Friendly support</span>
    </div>
</div>

<section>
    <div class="section-title">
        <strong>Why shoppers love us</strong>
        <hr>
    </div>
    <div class="feature-grid">
        <div class="feature-card">
            <h5>Calm & Clean Design</h5>
            <p>Every detail on the site is intentionally minimal, so your focus stays on the craftsmanship of the product.</p>
        </div>
        <div class="feature-card">
            <h5>Guided Discovery</h5>
            <p>Quick filters and gentle cues help you land on what fits your life, without overwhelming choices.</p>
        </div>
        <div class="feature-card">
            <h5>Secure, delightful checkout</h5>
            <p>We keep the full shopping experience smooth, transparent, and free of clutter.</p>
        </div>
    </div>
</section>

<section class="mt-5">
    <div class="section-title">
        <strong>Featured products</strong>
        <hr>
    </div>
    <p class="text-muted mb-4">Everything below is live inventory. Click in to see more details and add items directly to your cart.</p>
    <div class="product-grid">
        @foreach (var product in Model.Products)
        {
            <div class="product-card">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="badge-accent">@product.Category</span>
                    <span class="product-price">@product.Price.ToString("C")</span>
                </div>
                <img src="@Model.GetImageForCategory(product.Category ?? string.Empty)"
                     alt="@product.Name">
                <div class="mt-3">
                    <h5 class="card-title">@product.Name</h5>
                    <p class="card-text">Hand-picked to pair perfectly with your day.</p>
                </div>
                <form method="post" asp-page-handler="AddToCart" class="mt-4">
                    <input type="hidden" name="productId" value="@product.Id" />
                    <button type="submit" class="btn btn-primary w-100">Add to Cart</button>
                </form>
            </div>
        }
    </div>
</section>

<button id="open-chatbot" class="btn btn-primary chatbot-toggle">
    <i class="bi bi-chat-dots" style="font-size:1.25rem;"></i>
    <span>Chat with us</span>
</button>

<div id="chatbot-popup" class="chatbot-popup">
    <div class="chatbot-header">
        <img src="https://ui-avatars.com/api/?name=Bot&background=1b6ec2&color=fff&size=32" alt="Bot Avatar">
        <span>Retail Assistant</span>
        <div style="margin-left:auto; display:flex; gap:6px;">
            <button id="chatbot-fullscreen" class="btn btn-light btn-sm" title="Full screen" style="font-size:1.1rem;">&#x26F6;</button>
            <button id="chatbot-close" class="btn btn-light btn-sm">&times;</button>
        </div>
    </div>
    <div id="chatbot-messages" class="chatbot-messages"></div>
    <div class="chatbot-sample-questions" style="margin: 12px 0 0 0;">
        <div style="font-size:0.98rem; color:#555; margin-bottom:4px;">Quick questions:</div>
        <ul id="product-sample-questions" style="display:flex; flex-wrap:wrap; gap:6px; padding-left:0; margin-bottom:0; color:#444; font-size:0.95rem; list-style:none;">
            <li class="product-sample-question" style="cursor:pointer; transition:background 0.2s, color 0.2s; padding:4px 10px; border-radius:8px; background:#f6f6f6;">Best sellers?</li>
            <li class="product-sample-question" style="cursor:pointer; transition:background 0.2s, color 0.2s; padding:4px 10px; border-radius:8px; background:#f6f6f6;">Gift ideas?</li>
            <li class="product-sample-question" style="cursor:pointer; transition:background 0.2s, color 0.2s; padding:4px 10px; border-radius:8px; background:#f6f6f6;">New arrivals?</li>
            <li class="product-sample-question" style="cursor:pointer; transition:background 0.2s, color 0.2s; padding:4px 10px; border-radius:8px; background:#f6f6f6;">Popular electronics?</li>
            <li class="product-sample-question" style="cursor:pointer; transition:background 0.2s, color 0.2s; padding:4px 10px; border-radius:8px; background:#f6f6f6;">Eco-friendly options?</li>
            <li class="product-sample-question" style="cursor:pointer; transition:background 0.2s, color 0.2s; padding:4px 10px; border-radius:8px; background:#f6f6f6;">Return policy?</li>
        </ul>
    </div>
    <div class="chatbot-input-group">
        <input type="text" id="chatbot-input" placeholder="Type your message..." />
        <button id="chatbot-send" type="button" class="btn btn-secondary">Send</button>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        .product-sample-question:hover {
            background: #e3e3e3 !important;
            color: #1b6ec2 !important;
        }
        .chatbot-popup.fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            max-width: none !important;
            max-height: none !important;
            z-index: 9999 !important;
            border-radius: 0 !important;
            box-shadow: none !important;
        }
    </style>
    <script>
        const popup = document.getElementById('chatbot-popup');
        const openBtn = document.getElementById('open-chatbot');
        const closeBtn = document.getElementById('chatbot-close');
        const sendBtn = document.getElementById('chatbot-send');
        const input = document.getElementById('chatbot-input');
        const messages = document.getElementById('chatbot-messages');
        const fullscreenBtn = document.getElementById('chatbot-fullscreen');
        let isFullscreen = false;

        openBtn.onclick = () => {
            popup.style.display = 'flex';
            openBtn.style.display = 'none';
        };
        closeBtn.onclick = () => {
            popup.style.display = 'none';
            openBtn.style.display = 'flex';
            if (isFullscreen) {
                popup.classList.remove('fullscreen');
                fullscreenBtn.innerHTML = '&#x26F6;';
                fullscreenBtn.title = 'Full screen';
                isFullscreen = false;
            }
        };
        fullscreenBtn.onclick = () => {
            if (!isFullscreen) {
                popup.classList.add('fullscreen');
                fullscreenBtn.innerHTML = '&#x2715;';
                fullscreenBtn.title = 'Minimize';
                isFullscreen = true;
            } else {
                popup.classList.remove('fullscreen');
                fullscreenBtn.innerHTML = '&#x26F6;';
                fullscreenBtn.title = 'Full screen';
                isFullscreen = false;
            }
        };
        sendBtn.onclick = sendMessage;
        input.addEventListener('keydown', function (e) {
            if (e.key === 'Enter') sendMessage();
        });

        // Sample questions click-to-populate
        document.querySelectorAll('.product-sample-question').forEach(function(item) {
            item.addEventListener('click', function() {
                input.value = item.textContent;
                input.focus();
            });
        });

        function appendMessage(role, text) {
            const div = document.createElement('div');
            div.className = 'chatbot-message ' + (role === 'You' ? 'user' : 'bot');
            div.innerHTML = `
                <span>${text}</span>
            `;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }

        function sendMessage() {
            const userText = input.value.trim();
            if (!userText) return;
            appendMessage('You', userText);
            input.value = '';
            fetch('/api/chatbot', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: userText })
            })
            .then(res => res.json())
            .then(data => {
                appendMessage('Bot', data.reply);
            })
            .catch(() => {
                appendMessage('Bot', 'Sorry, something went wrong.');
            });
        }
    </script>
}
